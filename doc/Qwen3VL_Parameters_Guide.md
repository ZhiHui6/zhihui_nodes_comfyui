# Qwen3-VL高级版节点参数详解

本文档详细解释了Qwen3-VL高级版节点中所有参数选项的含义和使用方法，帮助用户更好地理解和使用该节点的各项功能。

---

## 🎯 核心功能参数

### **preset_prompt（预设提示词）**
- **作用**：选择预设的分析模式，提供多种专业的图像/视频分析模板
- **默认值**：`Ignore`
- **选项详解**：
  - `Ignore`：忽略预设，完全使用自定义提示词
  - **提示词风格类（Prompt Style）**：
    - `[Prompt Style]Tags`：生成干净的逗号分隔标签列表（最多50个），适合AI绘图提示词
    - `[Prompt Style]Simple`：生成简单的单句描述，适合快速概览
    - `[Prompt Style]Detailed`：生成详细的艺术性描述（2-3句），平衡详细度和可读性
    - `[Prompt Style]Extreme Detailed`：生成极其详细的沉浸式描述，包含丰富的视觉细节
    - `[Prompt Style]Cinematic`：生成电影风格的专业描述，强调视觉冲击力和艺术效果
  - **创意分析类（Creative）**：
    - `[Creative]Story`：以短篇小说开头的方式描述，富有文学性和想象力
    - `[Creative]Detailed Analysis`：详细分析主体、服装、背景等各部分，结构化描述
    - `[Creative]Summarize Video`：总结视频的关键事件和叙述要点，适用于视频内容
    - `[Creative]Short Story`：创作受图像启发的想象故事，发挥创意潜能
    - `[Creative]Refine & Expand Prompt`：优化和扩展用户提示词，提升AI绘图效果
  - **分析功能类（Analysis）**：
    - `[Analysis]Explain`：解释图像中发生的事情，客观描述内容
    - `[Analysis]Scene`：描述场景和设置，专注环境和背景
    - `[Analysis]Emotion`：描述情感或氛围，分析情绪表达
    - `[Analysis]Style`：描述艺术或视觉风格，分析美学特征
    - `[Analysis]Location`：分析拍摄地点或场所，推测地理位置
    - `[Analysis]Technical`：提供技术分析（构图、光线、色彩等），专业摄影视角
  - **实用工具类（Utility）**：
    - `[Utility]Compare`：比较和对比图像中的不同元素，突出差异和相似性

### **output_language（输出语言）**
- **作用**：控制AI回答的语言类型
- **默认值**：`Ignore`
- **选项**：
  - `Ignore`：不指定特定语言，由模型自主决定
  - `Chinese`：强制使用中文回答
  - `english`：强制使用英文回答
  - `Chinese&English`：使用中英双语回答（先中文后英文）

### **user_prompt（用户提示词）**
- **作用**：自定义分析指令，用户可以输入特定的分析需求
- **类型**：多行文本输入
- **使用建议**：
  - 当preset_prompt为"Ignore"时，此项为主要分析指令
  - 支持复杂的多行指令

### **system_prompt（系统提示词）**
- **作用**：设置AI的角色定位和行为规则
- **类型**：多行文本输入
- **使用场景**：
  - 定义AI的专业角色（如摄影师、艺术评论家等）
  - 设置特定的回答格式要求
  - 启用解锁限制时会被自动覆盖

### **unlock_restrictions（解锁限制）**
- **作用**：选择解锁限制模式
- **类型**：下拉选择（Disabled/Unlock_Instruction_A/Unlock_Instruction_B）
- **默认值**：`Disabled`
- **功能说明**：
  - **Disabled**：禁用解锁功能，使用标准模式
  - **Unlock_Instruction_A**：启用解锁指令A，可以分析和描述任何类型的图像内容
  - **Unlock_Instruction_B**：启用解锁指令B，使用全局规则进行内容分析
  - 启用任一解锁模式后会自动覆盖system_prompt为对应的解锁提示词
  - 会忽略output_language设置，默认使用中文输出
  - 提供直白、详细的内容描述

---

## 🤖 模型配置参数

### **model（模型选择）**
- **作用**：选择使用的Qwen3-VL模型版本
- **选项详解**：
  - **指令版本（Instruct Models）**：
    - `Qwen3-VL-4B-Instruct`：4B参数指令优化版，速度快，适合快速分析
    - `Qwen3-VL-8B-Instruct`：8B参数指令优化版，质量高，平衡性能与效果
  - **思维链版本（Thinking Models）**：
    - `Qwen3-VL-4B-Thinking`：4B思维链版本，具备逻辑推理能力，可展示思考过程
    - `Qwen3-VL-8B-Thinking`：8B思维链版本，深度分析能力强，推理过程详细
  - **特殊版本（Special Models）**：
    - `Huihui-Qwen3-VL-8B-Instruct-abliterated`：特殊优化版本，解除部分限制

### **quantization（量化设置）**
- **作用**：模型压缩以节省显存占用
- **默认值**：`none`
- **选项**：
  - `none`：无量化，保持最高质量和精度
  - `4bit`：4位量化，大幅节省显存，轻微质量损失
  - `8bit`：8位量化，平衡显存占用和质量

### **remove_think_tags（移除思考标签）**
- **作用**：控制是否移除Thinking模型输出中的思考过程标签
- **类型**：布尔值
- **默认值**：`True`
- **效果说明**：
  - `True`：移除`<think>`和`</think>`标签及其包含的思考过程，只保留最终答案
  - `False`：保留完整输出，包括思考过程和最终答案
- **适用场景**：
  - 仅在使用Thinking模型（如Qwen3-VL-4B-Thinking、Qwen3-VL-8B-Thinking）时有效
  - 对于Instruct模型，此参数无影响

### **device（设备选择）**
- **作用**：指定模型运行的硬件设备
- **默认值**：`auto`
- **选项**：
  - `auto`：自动选择最佳可用设备
  - `gpu`：强制使用GPU（需要CUDA支持）
  - `cpu`：使用CPU运行（速度较慢但兼容性好）

---

## ⚙️ 生成控制参数

### **temperature（温度）**
- **作用**：控制输出的随机性和创造性程度
- **类型**：浮点数
- **范围**：0.0 - 1.0
- **默认值**：0.7
- **调节步长**：0.1
- **效果说明**：
  - 低值（0.1-0.3）：输出更准确、保守、一致
  - 中值（0.4-0.7）：平衡准确性和创造性
  - 高值（0.8-1.0）：输出更有创意、多样、随机

### **top_p（核采样）**
- **作用**：控制词汇选择的多样性
- **类型**：浮点数
- **范围**：0.0 - 1.0
- **默认值**：0.9
- **调节步长**：0.1
- **效果说明**：
  - 低值：选择更保守的词汇
  - 高值：允许更多样的词汇选择

### **num_beams（束搜索）**
- **作用**：控制生成质量，使用束搜索算法
- **类型**：整数
- **范围**：1 - 10
- **默认值**：1
- **调节步长**：1
- **效果说明**：
  - 1：贪婪搜索，速度最快
  - 2-5：平衡质量和速度
  - 6-10：最高质量，但速度较慢

### **repetition_penalty（重复惩罚）**
- **作用**：避免输出内容重复
- **类型**：浮点数
- **范围**：0.1 - 2.0
- **默认值**：1.2
- **调节步长**：0.1
- **效果说明**：
  - 1.0：无惩罚
  - 1.1-1.3：轻微避免重复
  - 1.4-2.0：强烈避免重复

### **max_new_tokens（最大新词数）**
- **作用**：限制输出文本的最大长度
- **类型**：整数
- **范围**：128 - 2048
- **默认值**：2048
- **调节步长**：1
- **使用建议**：
  - 简短描述：128-512
  - 详细分析：512-1024
  - 长篇描述：1024-2048

---

## 🖼️ 图像处理参数

### **min_resolution（最小分辨率）**
- **作用**：设置图像处理的最小分辨率
- **类型**：整数
- **范围**：112 - 2048
- **默认值**：256
- **调节步长**：1
- **说明**：影响处理速度，值越小速度越快

### **max_resolution（最大分辨率）**
- **作用**：设置图像处理的最大分辨率
- **类型**：整数
- **范围**：256 - 4096
- **默认值**：1280
- **调节步长**：1
- **说明**：影响处理质量，值越大质量越好但速度越慢

### **frame_count（帧数）**
- **作用**：视频分析时的采样帧数
- **类型**：整数
- **范围**：1 - 64
- **默认值**：16
- **调节步长**：1
- **适用场景**：仅对视频文件有效，图像文件忽略此参数

---

## 🔧 高级功能参数

### **attention（注意力机制）**
- **作用**：选择注意力计算的实现方式
- **选项**：
  - `eager`：标准实现，兼容性最好
  - `sdpa`：优化实现，性能更好
  - `flash_attention_2`：高效实现，显存占用低
- **选择建议**：
  - 兼容性优先：选择`eager`
  - 性能优先：选择`sdpa`或`flash_attention_2`

### **keep_model_loaded（保持模型加载）**
- **作用**：控制模型是否常驻内存
- **类型**：布尔值
- **默认值**：`False`
- **效果**：
  - `True`：模型常驻内存，连续使用速度快，但占用显存
  - `False`：使用后释放内存，节省显存但重新加载需要时间

### **batch_mode（批量模式）**
- **作用**：启用批量处理多张图片功能
- **类型**：布尔值
- **默认值**：`False`
- **配合参数**：需要设置`batch_directory`指定图片目录
- **注意事项**：与单张图片输入端口互斥

### **batch_directory（批量目录）**
- **作用**：指定批量处理的图片目录路径
- **类型**：字符串
- **默认值**：空字符串
- **使用条件**：需要启用`batch_mode`

### **seed（随机种子）**
- **作用**：控制输出的可重复性
- **类型**：整数
- **默认值**：-1
- **说明**：
  - -1：使用随机种子，每次结果不同
  - 固定值：使用指定种子，结果可重现

---

## 📁 可选输入端口

### **source_path（源路径）**
- **作用**：直接指定单个图像或视频文件的路径
- **类型**：路径输入
- **使用场景**：当需要处理特定文件时使用
- **注意**：与批量模式互斥

### **extra_options（额外选项）**
- **作用**：连接Qwen3VL额外选项节点，精准控制模型行为
- **类型**：QWEN3VL_EXTRA_OPTIONS
- **功能**：提供额外的指令和角色设定

---

## ⚠️ 注意事项

1. **显存管理**：大模型需要足够的显存，建议至少8GB VRAM
2. **参数冲突**：批量模式与单张图片输入互斥
3. **NSFW功能**：启用破限功能会覆盖部分其他设置
4. **模型下载**：首次使用需要通过ModelDownloader节点下载模型
5. **性能优化**：根据硬件配置合理选择量化和分辨率设置
