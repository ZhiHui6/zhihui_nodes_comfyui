class ImageAspectRatio:
    PRESETS_QWEN = {
         "1:1(1328x1328)": (1328, 1328),
         "16:9(1664x928)": (1664, 928),
         "9:16(928x1664)": (928, 1664),
         "4:3(1472x1104)": (1472, 1104),
         "3:4(1104x1472)": (1104, 1472),
         "3:2(1584x1056)": (1584, 1056),
         "2:3(1056x1584)": (1056, 1584),
         "Cinema 4K(4032x2128)": (4032, 2128),
         "Cinema 2K(2016x1008)": (2016, 1008),
         "1080p(1904x1008)": (1904, 1008),
         "720p(1232x672)": (1232, 672),
    }

    PRESETS_FLUX = {
         "1:1(1024x1024)": (1024, 1024),
         "16:9(1344x768)": (1344, 768),
         "9:16(768x1344)": (768, 1344),
         "4:3(1152x864)": (1152, 864),
         "3:4(864x1152)": (864, 1152),
         "3:2(1216x832)": (1216, 832),
         "2:3(832x1216)": (832, 1216),
    }

    PRESETS_FLUX2 = {
         "1:1·S(1024x1024)": (1024, 1024),
         "1:1·M(1280x1280)": (1280, 1280),
         "1:1·L(1536x1536)": (1536, 1536),

         "16:9·S(1344x768)": (1344, 768),
         "16:9·M(1728x960)": (1728, 960),
         "16:9·L(2048x1152)": (2048, 1152),

         "9:16·S(768x1344)": (768, 1344),
         "9:16·M(960x1728)": (960, 1728),
         "9:16·L(1152x2048)": (1152, 2048),

         "4:3·S(1152x864)": (1152, 864),
         "4:3·M(1408x1056)": (1408, 1056),
         "4:3·L(1728x1296)": (1728, 1296),

         "3:4·S(864x1152)": (864, 1152),
         "3:4·M(1088x1472)": (1088, 1472),
         "3:4·L(1280x1728)": (1280, 1728),

         "3:2·S(1216x832)": (1216, 832),
         "3:2·M(1536x1024)": (1536, 1024),
         "3:2·L(1920x1280)": (1920, 1280),

         "2:3·S(832x1216)": (832, 1216),
         "2:3·M(1024x1536)": (1024, 1536),
         "2:3·L(1280x1920)": (1280, 1920),
    }

    PRESETS_FLUX2_KLEIN = {
         "1:1·S(768x768)": (768, 768),
         "1:1·M(896x896)": (896, 896),
         "1:1·L(1024x1024)": (1024, 1024),

         "16:9·S(1024x576)": (1024, 576),
         "16:9·M(1152x640)": (1152, 640),
         "16:9·L(1344x768)": (1344, 768),

         "9:16·S(576x1024)": (576, 1024),
         "9:16·M(640x1152)": (640, 1152),
         "9:16·L(768x1344)": (768, 1344),

         "4:3·S(768x576)": (768, 576),
         "4:3·M(960x704)": (960, 704),
         "4:3·L(1024x768)": (1024, 768),

         "3:4·S(576x768)": (576, 768),
         "3:4·M(704x960)": (704, 960),
         "3:4·L(768x1024)": (768, 1024),

         "3:2·S(960x640)": (960, 640),
         "3:2·M(1152x768)": (1152, 768),
         "3:2·L(1344x896)": (1344, 896),

         "2:3·S(640x960)": (640, 960),
         "2:3·M(768x1152)": (768, 1152),
         "2:3·L(896x1344)": (896, 1344),

         "Cinema 4K(4096x2160)": (4096, 2160),
         "Cinema 2K(2048x1072)": (2048, 1072),
         "1080p(1920x1072)": (1920, 1072),
         "720p(1280x720)": (1280, 720),
    }
    
    PRESETS_WAN = {
         "1:1(1024x1024)": (1024, 1024),
         "16:9(1280x720)": (1280, 720),
         "9:16(720x1280)": (720, 1280),
         "4:3(1024x768)": (1024, 768),
         "3:4(768x1024)": (768, 1024),
         "21:9(1344x576)": (1344, 576),
         "9:21(576x1344)": (576, 1344),
         "Cinema 4K(4096x2144)": (4096, 2144),
         "Cinema 2K(2048x1056)": (2048, 1056),
         "1080p(1920x1056)": (1920, 1056),
         "720p(1280x704)": (1280, 704),
    }
    
    PRESETS_SD = {
         "1:1(1024x1024)": (1024, 1024),
         "9:8(1152x896)": (1152, 896),
         "8:9(896x1152)": (896, 1152),
         "3:2(1216x832)": (1216, 832),
         "2:3(832x1216)": (832, 1216),
         "7:4(1344x768)": (1344, 768),
         "4:7(768x1344)": (768, 1344),
         "12:5(1536x640)": (1536, 640),
         "5:12(640x1536)": (640, 1536),
    }

    PRESETS_ZIMAGE = {
         "1:1(1024x1024)": (1024, 1024),
         "1:1(1280x1280)": (1280, 1280),
         "1:1(1536x1536)": (1536, 1536),
         "9:7(1152x896)": (1152, 896),
         "9:7(1440x1120)": (1440, 1120),
         "9:7(1728x1344)": (1728, 1344),
         "7:9(896x1152)": (896, 1152),
         "7:9(1120x1440)": (1120, 1440),
         "7:9(1344x1728)": (1344, 1728),
         "4:3(1152x864)": (1152, 864),
         "4:3(1472x1104)": (1472, 1104),
         "4:3(1728x1296)": (1728, 1296),
         "3:4(864x1152)": (864, 1152),
         "3:4(1104x1472)": (1104, 1472),
         "3:4(1296x1728)": (1296, 1728),
         "3:2(1248x832)": (1248, 832),
         "3:2(1536x1024)": (1536, 1024),
         "3:2(1872x1248)": (1872, 1248),
         "2:3(832x1248)": (832, 1248),
         "2:3(1024x1536)": (1024, 1536),
         "2:3(1248x1872)": (1248, 1872),
         "16:9(1280x720)": (1280, 720),
         "16:9(1536x864)": (1536, 864),
         "16:9(2048x1152)": (2048, 1152),
         "9:16(720x1280)": (720, 1280),
         "9:16(864x1536)": (864, 1536),
         "9:16(1152x2048)": (1152, 2048),
         "21:9(1344x576)": (1344, 576),
         "21:9(1680x720)": (1680, 720),
         "21:9(2016x864)": (2016, 864),
         "9:21(576x1344)": (576, 1344),
         "9:21(720x1680)": (720, 1680),
         "9:21(864x2016)": (864, 2016),
         "Cinema 4K(4096x2112)": (4096, 2112),
         "Cinema 2K(2048x1024)": (2048, 1024),
         "1080p(1920x1024)": (1920, 1024),
         "720p(1280x704)": (1280, 704),
    }

    @classmethod
    def INPUT_TYPES(s):
        all_aspect_ratios = list(set(
            list(s.PRESETS_QWEN.keys()) +
            list(s.PRESETS_FLUX.keys()) +
            list(s.PRESETS_FLUX2.keys()) +
            list(s.PRESETS_FLUX2_KLEIN.keys()) +
            list(s.PRESETS_WAN.keys()) +
            list(s.PRESETS_SD.keys()) +
            list(s.PRESETS_ZIMAGE.keys())
        ))

        return {
            "required": {
                "preset_mode": (["Qwen image", "Flux", "Flux.2", "Flux2 klein", "Wan", "SDXL", "Z-image", "Custom Size"], {"default": "Z-image"}),
                "aspect_ratio": (all_aspect_ratios, {"default": "1:1(1328x1328)"}),
            },
            "optional": {
                "custom_width": ("INT", {"default": 1328, "min": 1, "max": 8192, "step": 1}),
                "custom_height": ("INT", {"default": 1328, "min": 1, "max": 8192, "step": 1}),
                "aspect_lock": ("BOOLEAN", {"default": False}),
            }
        }

    RETURN_TYPES = ("INT", "INT")
    RETURN_NAMES = ("width", "height")
    FUNCTION = "get_dimensions"
    CATEGORY = "Zhi.AI/Image"
    DESCRIPTION = "Smart image aspect ratio setting node, supporting preset dimensions for multiple models like Qwen, Flux, Wan, SDXL, with quick selection of common ratios or custom sizes"

    def get_dimensions(self, preset_mode, aspect_ratio, custom_width=1328, custom_height=1328, aspect_lock=False):
        if custom_width is None:
            custom_width = 1328
        if custom_height is None:
            custom_height = 1328

        if preset_mode == "Custom Size":
            return (custom_width, custom_height)

        preset_maps = {
            "Qwen image": self.PRESETS_QWEN,
            "Flux": self.PRESETS_FLUX,
            "Flux.2": self.PRESETS_FLUX2,
            "Flux2 klein": self.PRESETS_FLUX2_KLEIN,
            "Wan": self.PRESETS_WAN,
            "SDXL": self.PRESETS_SD,
            "Z-image": self.PRESETS_ZIMAGE
        }

        preset_map = preset_maps.get(preset_mode, self.PRESETS_QWEN)

        if aspect_ratio in preset_map:
            return preset_map[aspect_ratio]
        else:
            return (custom_width, custom_height)